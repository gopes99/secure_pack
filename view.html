
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>View Container Data</title>
  <style>
    body { font-family: sans-serif; max-width: 500px; margin: auto; padding: 1em; text-align: center; }
    input { width: 100%; margin: 0.5em 0; padding: 0.5em; }
    #decrypted { margin-top: 20px; word-wrap: break-word; }
  </style>
</head>
<body>
  <h2>Decrypt Container Info</h2>
  <p>Encrypted data was found in the URL. Enter the shared key to decrypt:</p>
  <input type="text" id="key" placeholder="Enter shared key">
  <button onclick="decryptNow()">Decrypt</button>
  <div id="decrypted"></div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const encryptedData = urlParams.get("data");
    const allowedCredentialIds = [
                                    "7DBAU7Q95Tx7GT3TLcrfAJxXEIA",
                                    "0ROJC+nos+nvygnz9y6YTHEeyQw="
                                  ];


    if (!encryptedData) {
      document.body.innerHTML = "<p style='color:red'>No encrypted data found in URL.</p>";
    }

    async function getKeyMaterial(password) {
      return crypto.subtle.importKey("raw", new TextEncoder().encode(password), "PBKDF2", false, ["deriveKey"]);
    }

    async function deriveKey(password) {
      const keyMaterial = await getKeyMaterial(password);
      return crypto.subtle.deriveKey({
        name: "PBKDF2",
        salt: new TextEncoder().encode("fixed-salt"),
        iterations: 100000,
        hash: "SHA-256"
      }, keyMaterial, { name: "AES-GCM", length: 256 }, false, ["encrypt", "decrypt"]);
    }

    async function decryptData(base64, password) {
      const data = Uint8Array.from(atob(base64), c => c.charCodeAt(0));
      const iv = data.slice(0, 12);
      const encData = data.slice(12);
      const key = await deriveKey(password);
      const plainBuffer = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, encData);
      return new TextDecoder().decode(plainBuffer);
    }

    async function decryptNow() {
      const key = document.getElementById("key").value;
      if (!key) return alert("Please enter the shared key.");
      try {
        const decrypted = await decryptData(encryptedData, key);
        document.getElementById("decrypted").innerText = decrypted;
      } catch (e) {
        alert("Failed to decrypt. Check the key.");
      }
    }
  </script>
</body>
</html>
